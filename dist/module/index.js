(()=>{"use strict";const t=function(){function t(){this.events_queue={}}return t.prototype.on=function(t,e){return Array.isArray(this.events_queue[t])||(this.events_queue[t]=[]),this.events_queue[t].push(e),this},t.prototype.trigger=function(t,e){void 0===e&&(e=[]);for(var o=this.events_queue[t]||[],i=0;i<o.length;i++)o[i].apply(this,e);return this},t.prototype.clearAll=function(){return this.events_queue={},this},t}(),e=function(){function e(e){this.options=$.extend({loadOnScroll:!1,maxHeight:500,title:"summernote image gallery",close_text:"Close",ok_text:"Add",selectAll_text:"Select all",deselectAll_text:"Deselect all",noImageSelected_msg:"One image at least must be selected."},e),this.event=new t,this.template=this.getModalTemplate(),this.$modal=$(this.template).hide(),this.select_class="selected-img",this.addStyleToDom(),this.setOptions(),this.attachEvents()}return e.prototype.setOptions=function(){this.$modal.find(".modal-body").css("max-height",this.options.maxHeight),this.$modal.find(".modal-title").html(this.options.title),this.$modal.find("#close").html(this.options.close_text),this.$modal.find("#save").html(this.options.ok_text),this.$modal.find("#select-all").html(this.options.selectAll_text),this.$modal.find("#deselect-all").html(this.options.deselectAll_text)},e.prototype.addImages=function(t,e){var o=this.createImages(t,e);this.$modal.find(".images-list").find(".img-item").length?this.$modal.find(".images-list").append(o):this.$modal.find(".images-list").html(o)},e.prototype.createImages=function(t,e){for(var o=this,i=[],n=0;n<t.length;n++){var s=$('<img class="img-thumbnail sng-image" title="'+t[n].title+'" data-page="'+e+'"/>');s.get(0).onload=function(){$(this).siblings(".loading").hide(),$(this).click((function(t){$(this).toggleClass(o.select_class)}))},s.attr("src",t[n].src);var a=$('<div class="col-md-2 mb-4 img-item"><i class="fa fa-check"></i><span class="loading"><i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i></span></div>');a.prepend(s),i.push(a)}return i},e.prototype.showError=function(t,e){void 0===e&&(e=!1);var o=this.$modal.find(".message");o.html('<span class="alert alert-danger">'+t+"</span>"),e||setTimeout((function(){o.html("")}),5e3)},e.prototype.showLoading=function(){this.$modal.find(".modal-footer .loading").show()},e.prototype.hideLoading=function(){this.$modal.find(".modal-footer .loading").hide()},e.prototype.attachEvents=function(){var t=this,e=this.$modal,o=e.find(".modal-body");e.find("button#save").click((function(o){var i=e.find(".img-item img."+t.select_class);i.length?(e.modal("hide"),t.event.trigger("beforeSave",[t]),i.each((function(e,o){t.event.trigger("save",[t,$(this)]),$(this).removeClass(t.select_class)})),t.event.trigger("afterSave",[this])):t.showError(t.options.noImageSelected_msg)})),e.on("hidden.bs.modal",(function(){t.event.trigger("close")})),e.find("button#select-all").click((function(o){e.find("img").addClass(t.select_class)})),e.find("button#deselect-all").click((function(o){e.find("img").removeClass(t.select_class)})),o.scroll((function(){var i=e.find(".images-list");o.scrollTop()+o.height()>=i.height()-100&&t.event.trigger("scrollBottom",[t])}))},e.prototype.open=function(){this.$modal.modal()},e.prototype.clearContent=function(){this.$modal.find(".images-list").html("")},e.prototype.imagesContainerHasScroll=function(){var t=this.$modal.find(".modal-body"),e=t.find(".images-list");return parseInt(e.height())>parseInt(t.height())},e.prototype.getModalTemplate=function(){var t=['<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>','<h4 class="modal-title">[gallery title]</h4>'];return'<div class="modal summernote-gallery fade" tabindex="-1" role="dialog"><div class="modal-lg modal-dialog "><div class="modal-content"><div class="modal-header">'+(3==parseInt($.fn.modal.Constructor.VERSION)?t.join(""):t.reverse().join(""))+'</div><div class="modal-body"><div class="row images-list"></div></div><div class="modal-footer"><span style="display: none;position: absolute;left: 10px;bottom: 10px;" class="loading" ><i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i></span ><span style="display: inline-block; margin-right: 50px;"><button type="button" id="deselect-all" class="btn btn-default">[Deselect-all]</button><button type="button" id="select-all" class="btn btn-default">[select-all]</button></span ><button type="button" id="close" class="btn btn-default" data-dismiss="modal">[Close]</button><button type="button" id="save" class="btn btn-primary">[Add]</button><span class="message" ></span ></div></div></div></div>'},e.prototype.addStyleToDom=function(){this.$css=$("<style>.img-item{position : relative;}.img-item .fa-check{position : absolute;top : -10px;right : 5px;font-size: 30px;color: #337AB7;}.img-item .sng-image{}.img-item .loading{position: absolute;margin: auto;top: -20px;bottom: 0;display: block;left: 0;right: 0;width: 60px;height: 42px;text-align: center;}.modal.summernote-gallery .message{display: block;padding: 30px 0 20px 0;}.modal.summernote-gallery .message:empty{display: block;padding: 0px!important;}.modal.summernote-gallery .modal-body{overflow: scroll;}.img-item .fa-check{display : none;}.img-item ."+this.select_class+" + .fa-check{display : block;}."+this.select_class+"{background-color: #5CB85C;}</style>"),this.$css.appendTo("body")},e}();var o=function(){return o=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++)for(var n in e=arguments[o])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},o.apply(this,arguments)};const i=function(){function e(t){this.options=o({url:null,data:[],responseDataKey:"data",nextPageKey:"links.next"},t),this.init()}return e.prototype.init=function(){this.current_page=0,this.is_fetching_locked=!1,this.event=new t,this.fetch_url=this.options.url,this.fetch_type=this.options.data.length?"data":this.fetch_url?"url":null},e.prototype.setNextFetch=function(t){t.next_link&&t.data.length?this.fetch_url=t.next_link:this.lockFetching()},e.prototype.lockFetching=function(){this.is_fetching_locked=!0},e.prototype.unlockFetching=function(){this.is_fetching_locked=!1},e.prototype.getObjectKeyByString=function(t,e,o){var i=e.split(".").reduce((function(t,e){return t?t[e]:{}}),t);return void 0===o&&(o=i),i&&!$.isEmptyObject(i)?i:o},e.prototype.parseResponse=function(t){return{data:this.getObjectKeyByString(t,this.options.responseDataKey,[]),next_link:this.getObjectKeyByString(t,this.options.nextPageKey,null)}},e.prototype.fetchData=function(){var t=this;if("data"==this.fetch_type)this.event.trigger("beforeFetch"),this.event.trigger("fetch",[t.options.data]),this.event.trigger("afterFetch");else if("url"==this.fetch_type){if(this.is_fetching_locked)return;var e=t.fetch_url;this.event.trigger("beforeFetch"),this.lockFetching(),$.ajax({url:e,beforeSend:function(t){t.request_link=e}}).always((function(){t.unlockFetching()})).done((function(e,o,i){var n=t.parseResponse(e);t.current_page++,t.setNextFetch(n),t.event.trigger("fetch",[n.data,t.current_page,i.request_link,n.next_link])})).fail((function(){t.event.trigger("error",["problem loading from "+e])})).always((function(){t.event.trigger("afterFetch")}))}else t.event.trigger("error",["options 'data' or 'url' must be set"])},e.prototype.fetchNext=function(){"url"==this.fetch_type&&this.fetchData()},e}(),n=function(){function t(t){this.options=$.extend({name:"summernoteGallery",buttonLabel:'<i class="fa fa-file-image-o"></i> SN Gallery',tooltip:"summernote gallery"},t),this.plugin_default_options={}}return t.prototype.recoverEditorFocus=function(){var t=$(this.editor).data("last_focused_element");if(void 0!==t){var e=this.editable,o=document.createRange(),i=window.getSelection(),n=t.length;o.setStart(t,n),o.collapse(!0),i.removeAllRanges(),i.addRange(o),e.focus()}},t.prototype.saveLastFocusedElement=function(){var t=window.getSelection().focusNode,e=$(this.editable).get(0);$.contains(e,t)&&$(this.editor).data("last_focused_element",t)},t.prototype.attachEditorEvents=function(){var t=this;$(this.editable).on("keypress, mousemove",(function(){t.saveLastFocusedElement()})),$(this.editable).on("click","summernote-gallery-brick .delete",(function(){})),$(this.editable).on("click","summernote-gallery-brick .edit",(function(){var e=$(this).parents("summernote-gallery-brick").data("brick");t.modal.open(e)}))},t.prototype.initGallery=function(t){this.context=t,this.editor=this.context.layoutInfo.note,this.editable=this.context.layoutInfo.editable,this.plugin_options=$.extend(this.plugin_default_options,this.context.options[this.options.name]||{}),this.modal=new e(this.plugin_options.modal),this.data_manager=new i(this.plugin_options.source),this.attachModalEvents(),this.attachEditorEvents()},t.prototype.attachModalEvents=function(){var t=this;this.modal.event.on("beforeSave",(function(e){t.recoverEditorFocus()})),this.modal.event.on("save",(function(e,o){t.context.invoke("editor.pasteHTML",'<img src="'+o.attr("src")+'" alt="'+(o.attr("alt")||"")+'" />')})),this.modal.event.on("scrollBottom",(function(e){t.modal.options.loadOnScroll&&t.data_manager.fetchNext()})),this.modal.event.on("close",(function(e){t.data_manager.init(),t.modal.clearContent()}))},t.prototype.createButton=function(){var t=this;return $.summernote.ui.button({className:"w-100",contents:this.options.buttonLabel,tooltip:this.options.tooltip,click:function(){t.openGallery()}}).render()},t.prototype.attachDataEvents=function(){var t=this;this.data_manager.event.on("beforeFetch",(function(){t.modal.showLoading()})).on("fetch",(function(e,o,i){t.modal.addImages(e,o),setTimeout((function(){t.modal.options.loadOnScroll&&!t.modal.imagesContainerHasScroll()&&t.data_manager.fetchNext()}),2e3)})).on("afterFetch",(function(){t.modal.hideLoading()})).on("error",(function(e){t.modal.showError(e,!0)}))},t.prototype.openGallery=function(){this.attachDataEvents(),this.data_manager.fetchData(),this.modal.open()},t}();!function(){function t(t){this.summernote_gallery=new n(t)}t.prototype.getPlugin=function(){var t={},e=this,o=this.summernote_gallery.options;return t[o.name]=function(t){var i=(t.options[o.name]||{}).buttonLabel||e.summernote_gallery.options.buttonLabel;e.summernote_gallery.options.buttonLabel=i,t.memo("button."+o.name,e.createButton()),this.events={"summernote.keyup":function(t,o){e.summernote_gallery.saveLastFocusedElement()}},this.initialize=function(){e.summernote_gallery.initGallery(t)}},t},t.prototype.createButton=function(){return this.summernote_gallery.createButton()}}()})();
//# sourceMappingURL=index.js.map